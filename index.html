<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Arcade</title>

<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#050608">

<style>
body{
  margin:0;
  background:#050608;
  color:#00ffea;
  font-family:Arial, sans-serif;
  overflow:hidden;
}
canvas{display:block}

.overlay{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:rgba(5,6,8,0.85);
}

.hidden{display:none}

.btn{
  padding:16px 50px;
  font-size:18px;
  margin:10px;
  background:#050608;
  color:#00ffea;
  border:2px solid #00ffea;
  border-radius:10px;
  cursor:pointer;
  box-shadow:0 0 15px #00ffea;
}
.btn:hover{background:#00ffea;color:#050608}

.hud{
  position:fixed;
  top:20px;
  left:20px;
}
</style>
</head>
<body>

<!-- MENU -->
<div id="menu" class="overlay">
  <h1>NEON ARCADE</h1>
  <button class="btn" onclick="Engine.start('dodge')">Dodge</button>
  <button class="btn" onclick="Engine.start('reaction')">Reaction</button>
  <button class="btn" onclick="Engine.showSettings()">Settings</button>
</div>

<!-- SETTINGS -->
<div id="settings" class="overlay hidden">
  <h2>Settings</h2>
  <label>Volume</label>
  <input type="range" min="0" max="1" step="0.05" id="volume">
  <br><br>
  <button class="btn" onclick="Engine.saveSettings()">Save</button>
</div>

<!-- PAUSE -->
<div id="pause" class="overlay hidden">
  <h2>Paused</h2>
  <button class="btn" onclick="Engine.resume()">Resume</button>
  <button class="btn" onclick="Engine.quit()">Quit</button>
</div>

<div class="hud" id="hud"></div>
<canvas id="game"></canvas>

<script>
/* ================== CORE ENGINE ================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize", resize);
resize();

let lastTime = 0;

/* ================== INPUT ================== */
const Input = {
  keys:{},
  init(){
    addEventListener("keydown",e=>{
      this.keys[e.key]=true;
      if(e.key==="Escape") Engine.togglePause();
    });
    addEventListener("keyup",e=>this.keys[e.key]=false);
  }
};

/* ================== AUDIO ================== */
const AudioSys = {
  volume:0.5,
  beep(){
    const a = new AudioContext();
    const o = a.createOscillator();
    o.connect(a.destination);
    o.frequency.value=400;
    o.start();
    setTimeout(()=>o.stop(),80);
  }
};

/* ================== ENGINE ================== */
const Engine = {
  state:"menu",
  game:null,
  score:0,
  start(name){
    this.state="game";
    hideAll();
    this.score=0;
    this.game = Games[name];
    this.game.init();
  },
  update(dt){
    if(this.state==="game") this.game.update(dt);
  },
  draw(){
    if(this.state==="game") this.game.draw();
  },
  togglePause(){
    if(this.state==="game"){
      this.state="pause";
      show("pause");
    }else if(this.state==="pause"){
      this.resume();
    }
  },
  resume(){
    this.state="game";
    hide("pause");
  },
  quit(){
    this.state="menu";
    hideAll();
    show("menu");
  },
  showSettings(){
    hideAll();
    show("settings");
  },
  saveSettings(){
    AudioSys.volume=document.getElementById("volume").value;
    hide("settings");
    show("menu");
  }
};

/* ================== GAMES ================== */
const Games = {

  dodge:{
    init(){
      this.player={x:200,y:200,s:30,v:400};
      this.enemy={x:100,y:100,s:40,vx:300,vy:300};
    },
    update(dt){
      const p=this.player;
      if(Input.keys.w||Input.keys.ArrowUp) p.y-=p.v*dt;
      if(Input.keys.s||Input.keys.ArrowDown) p.y+=p.v*dt;
      if(Input.keys.a||Input.keys.ArrowLeft) p.x-=p.v*dt;
      if(Input.keys.d||Input.keys.ArrowRight) p.x+=p.v*dt;

      const e=this.enemy;
      e.x+=e.vx*dt; e.y+=e.vy*dt;
      if(e.x<0||e.x+e.s>canvas.width) e.vx*=-1;
      if(e.y<0||e.y+e.s>canvas.height) e.vy*=-1;

      if(
        p.x<e.x+e.s&&p.x+p.s>e.x&&
        p.y<e.y+e.s&&p.y+p.s>e.y
      ){
        AudioSys.beep();
        Engine.quit();
      }
      Engine.score+=dt*60;
    },
    draw(){
      ctx.fillStyle="#00ffea";
      ctx.fillRect(this.player.x,this.player.y,this.player.s,this.player.s);
      ctx.fillStyle="#ff0066";
      ctx.fillRect(this.enemy.x,this.enemy.y,this.enemy.s,this.enemy.s);
      hud.innerText="Score: "+Math.floor(Engine.score);
    }
  },

  reaction:{
    init(){
      this.target=null;
    },
    update(){
      if(!this.target){
        this.target={
          x:Math.random()*(canvas.width-50),
          y:Math.random()*(canvas.height-50)
        };
      }
    },
    draw(){
      ctx.fillStyle="#00ffea";
      ctx.fillRect(this.target.x,this.target.y,50,50);
    }
  }
};

/* ================== LOOP ================== */
function loop(t){
  const dt=(t-lastTime)/1000;
  lastTime=t;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  Engine.update(dt);
  Engine.draw();
  requestAnimationFrame(loop);
}

/* ================== UI HELPERS ================== */
const menu=document.getElementById("menu");
const pause=document.getElementById("pause");
const settings=document.getElementById("settings");
const hud=document.getElementById("hud");

function hideAll(){
  menu.classList.add("hidden");
  pause.classList.add("hidden");
  settings.classList.add("hidden");
}
function show(id){document.getElementById(id).classList.remove("hidden")}
function hide(id){document.getElementById(id).classList.add("hidden")}

Input.init();
requestAnimationFrame(loop);

if("serviceWorker"in navigator){
  navigator.serviceWorker.register("/service-worker.js");
}
</script>
</body>
</html>
