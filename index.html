<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Arcade</title>

<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#050608">

<style>
body{
  margin:0;
  background:#050608;
  color:#00ffea;
  font-family:Arial, sans-serif;
  overflow:hidden;
}
canvas{display:block}

.overlay{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:rgba(5,6,8,0.9);
}

.hidden{display:none}

.btn{
  padding:16px 50px;
  font-size:18px;
  margin:10px;
  background:#050608;
  color:#00ffea;
  border:2px solid #00ffea;
  border-radius:10px;
  cursor:pointer;
  box-shadow:0 0 15px #00ffea;
}
.btn:hover{background:#00ffea;color:#050608}

#hud{
  position:fixed;
  top:20px;
  left:20px;
}
</style>
</head>
<body>

<!-- MENU -->
<div id="menu" class="overlay">
  <h1>NEON ARCADE</h1>
  <button class="btn" onclick="Engine.start('dodge')">Dodge</button>
  <button class="btn" onclick="Engine.start('reaction')">Reaction</button>
  <button class="btn" onclick="Engine.showSettings()">Settings</button>
</div>

<!-- SETTINGS -->
<div id="settings" class="overlay hidden">
  <h2>Settings</h2>
  <label>Difficulty</label>
  <select id="difficulty">
    <option value="1">Easy</option>
    <option value="1.5">Normal</option>
    <option value="2">Hard</option>
  </select>
  <br><br>
  <button class="btn" onclick="Engine.saveSettings()">Save</button>
</div>

<!-- PAUSE -->
<div id="pause" class="overlay hidden">
  <h2>Paused</h2>
  <button class="btn" onclick="Engine.resume()">Resume</button>
  <button class="btn" onclick="Engine.quit()">Quit</button>
</div>

<div id="hud"></div>
<canvas id="game"></canvas>

<script>
/* ================= CORE ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize", resize);
resize();

/* ================= INPUT ================= */
const Input = {
  keys:{},
  init(){
    addEventListener("keydown",e=>{
      this.keys[e.key]=true;
      if(e.key==="Escape") Engine.togglePause();
    });
    addEventListener("keyup",e=>this.keys[e.key]=false);
  }
};

/* ================= AUDIO ================= */
const AudioSys = {
  ctx:new (window.AudioContext||window.webkitAudioContext)(),
  beep(freq=500){
    const o=this.ctx.createOscillator();
    o.frequency.value=freq;
    o.connect(this.ctx.destination);
    o.start();
    setTimeout(()=>o.stop(),80);
  }
};

/* ================= ENGINE ================= */
const Engine = {
  state:"menu",
  game:null,
  last:0,
  score:0,
  difficulty:localStorage.getItem("difficulty")||1,

  start(name){
    this.state="game";
    hideAll();
    this.score=0;
    this.game=Games[name];
    this.game.init();
  },

  update(dt){
    if(this.state==="game") this.game.update(dt);
  },

  draw(){
    if(this.state==="game") this.game.draw();
  },

  togglePause(){
    if(this.state==="game"){
      this.state="pause";
      show("pause");
    }else if(this.state==="pause"){
      this.resume();
    }
  },

  resume(){
    this.state="game";
    hide("pause");
  },

  quit(){
    this.state="menu";
    hideAll();
    show("menu");
  },

  showSettings(){
    hideAll();
    show("settings");
  },

  saveSettings(){
    this.difficulty=document.getElementById("difficulty").value;
    localStorage.setItem("difficulty",this.difficulty);
    hide("settings");
    show("menu");
  }
};

/* ================= GAMES ================= */
const Games = {

  dodge:{
    init(){
      this.p={x:200,y:200,s:30,v:300*Engine.difficulty};
      this.e={x:100,y:100,s:40,vx:250*Engine.difficulty,vy:250*Engine.difficulty};
    },
    update(dt){
      const p=this.p;
      if(Input.keys.w||Input.keys.ArrowUp) p.y-=p.v*dt;
      if(Input.keys.s||Input.keys.ArrowDown) p.y+=p.v*dt;
      if(Input.keys.a||Input.keys.ArrowLeft) p.x-=p.v*dt;
      if(Input.keys.d||Input.keys.ArrowRight) p.x+=p.v*dt;

      const e=this.e;
      e.x+=e.vx*dt; e.y+=e.vy*dt;
      if(e.x<0||e.x+e.s>canvas.width) e.vx*=-1;
      if(e.y<0||e.y+e.s>canvas.height) e.vy*=-1;

      if(
        p.x<e.x+e.s&&p.x+p.s>e.x&&
        p.y<e.y+e.s&&p.y+p.s>e.y
      ){
        AudioSys.beep();
        Engine.quit();
      }
      Engine.score+=dt*60;
    },
    draw(){
      ctx.fillStyle="#00ffea";
      ctx.fillRect(this.p.x,this.p.y,this.p.s,this.p.s);
      ctx.fillStyle="#ff0066";
      ctx.fillRect(this.e.x,this.e.y,this.e.s,this.e.s);
      hud.textContent="Score: "+Math.floor(Engine.score);
    }
  },

  reaction:{
    init(){this.t=null},
    update(){
      if(!this.t){
        this.t={x:Math.random()*(canvas.width-50),y:Math.random()*(canvas.height-50)};
      }
    },
    draw(){
      ctx.fillStyle="#00ffea";
      ctx.fillRect(this.t.x,this.t.y,50,50);
      hud.textContent="Clicks: "+Engine.score;
    }
  }
};

/* ================= LOOP ================= */
let last=0;
function loop(t){
  const dt=(t-last)/1000;
  last=t;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  Engine.update(dt);
  Engine.draw();
  requestAnimationFrame(loop);
}

/* ================= UI ================= */
const hud=document.getElementById("hud");
function hideAll(){
  document.querySelectorAll(".overlay").forEach(e=>e.classList.add("hidden"));
}
function show(id){document.getElementById(id).classList.remove("hidden")}
function hide(id){document.getElementById(id).classList.add("hidden")}

Input.init();
requestAnimationFrame(loop);

if("serviceWorker"in navigator){
  navigator.serviceWorker.register("/service-worker.js");
}
</script>
</body>
</html>
